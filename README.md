#Headless Wordpress Marketplace with Gatsby
##_Demo Marketplace for Hotels at Home_

###Initial Setup
Env Variables are in `/backend/sample.env` and are referenced in `/backend/docker-compose.yml`

- Rename `sample.env` to `.env`
- Sample creds will work
- Install [Yarn](https://classic.yarnpkg.com/en/docs/install/#mac-stable) and [Docker](https://docs.docker.com/install/)
- In project root, run `yarn`

#####_Retrieve demo data from 01 Test DB_
- Open `/backend/wp-data/data-query.sql`
- Run query on HAHAPP
- Export as CSV

###Start the Wordpress Backend
- In project root, run `yarn workspace backend start`
- Access backend at [http://localhost:3030/wp-admin](http://localhost:3030/wp-admin)

#####_Initial WP setup_
- Run through WP Install process
- Go to Settings -> Permalinks in sidebar
- Under Common Settings select Post Name and save settings
- Go to [http://localhost:3030/wp-admin/plugins.php](http://localhost:3030/wp-admin/plugins.php) and activate all plugins
- Click "Add New" at the top of the plugins page
- Search for Woocommerce and Install

_Activate WooCommerce REST API_

- In the sidebar, go to Woocommerce -> Settings
- Open the Advanced tab and then open the REST API tab
- Click Add key button
- Add a description and activate Read/Write permissions
- Open `/frontend/gatsby-config.js`
- On line 33 and 34 under `plugins.gatsby-source-woocommerce.api_keys` add the consumer\_key and consumer\_secret generated by Woocommerce

_Add JWT Key_

- Open `/backend/wordpress/wp-config.php`
- Add `define('JWT_AUTH_SECRET_KEY', '[YOUR_JWT_SECRET]');` and replace YOUR\_JWT\_SECRET with any string to be used as an Auth Key

_Add products to store_

- Click the Products tab in the sidebar
- Click "Import" button at the top of the page
- Import the demo data csv, confirm column names to match product info.

###Start the Gatsby Frontend
- In project root, run `yarn workspace frontend start`
- Access frontend at [http://localhost:8000/](http://localhost:8000/)

##Current Issues to be Resolved

- `<ATCButton>` component axios POST request returning 500 error
- `<Cart>` axios GET request is returning empty array
- `<Dashboard>` axios GET request is 404ing
- `<ATCButton>` not receiving token from `<AuthContext>` created in `<AuthWrapper>` component
    - Currently have a `<ATCButton>` instance as a child of `<Auth>` in the header to test the token as direct props

##Plugin reference
###Cocart (Currently using free version)
_Extends WooCommerce API to access Cart info_

[Cocart Documentation](https://docs.cocart.xyz/index.html#introduction)

###WooCommerce Subscription plugin
[Official Plugin Page](https://woocommerce.com/products/woocommerce-subscriptions/)

No free trial, but the plugin page explains all features

###WooCommerce Vendor Plugin
[Official Plugin Page](https://woocommerce.com/products/product-vendors/)

#####_Create a Trial Site_

- Click the button below the Add To Cart button "Want to test this plugin?"
- With a Wordpress.com account, login to Woocommerce.com
- Woocommerce will create a temporary WP site with the plugin installed.
- Go to Plugins in the sidebar
- Activate Woocommerce Product Vendors and WooCommerce Product CSV Import Suite

#####_Import Demo Data_

- Go to Woocommerce -> CSV Import Suite in the sidebar
- Click Import Products and upload demo data csv

#####_Create a Paypal Sandbox Account_
- Go to [https://developer.paypal.com/developer/accounts](https://developer.paypal.com/developer/accounts)
- Create an account
- Go to `/wp-admin/admin.php?page=wc-settings&tab=checkout&section=paypal` on the test site
- Under API Credentials click the link to `Learn how to access your PayPal API Credentials.`
- Create API creds and add Sandbox API username/password/signature on WP.
- Go to Sandbox -> Accounts in the Paypal Developer Sidebar
- For any of the accounts, under Manage Accounts
- Click View/Edit account
- Use the Email ID and System Generated Password whenever logging into Paypal at Checkout 

#####_Create Vendors_
- In Wordpress go to Products -> Vendors in the sidebar
- Add a name of a vendor and slug
- Click Additional Settings
- Add Vendor Email / Commission / Commission Type 
- Click Add Vendor button
- Repeat with multiple vendors, use either the same or different emails for each
- Go to Products in the sidebar and edit some products to have different vendors

#####_Test Checkout_
- Go to `/shop` and add products to the cart that have different vendors
- Checkout with Paypal sandbox account and look for confirmation emails

Vendors will each get notified of sales totaling their defined commission, and the Wordpress admin email will receive an new order alert with all purchased items. Payout can be manual or automatic. Scheduled or Immediate